<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="assets/css/login.css">
  <link rel="shortcut icon" href="" type="image/x-icon">
  <link rel="shortcut icon" href="assets/img/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <!-- Inclua o JavaScript do Toastify -->
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <title>Login e Cadastro</title>
</head>

<body>

  <div class="container">
    <div class="forms-container">
      <div class="signin-signup">
        <form id="loginForm" action="/entrar" class="sign-in-form" method="post">
          <img src="assets/img/logo.png" alt="logo" style="height: 100px;">
          <h2 class="title">Login</h2>
          <div class="input-field">
            <i class="fas fa-envelope"></i>
            <input type="email" name="email" autocomplete="email" placeholder="E-mail" required>
          </div>
          <div class="input-field">
            <i class="fas fa-lock"></i>
            <input type="password" name="senha" autocomplete="password" placeholder="Senha" id="password" required>
            <i class="far fa-eye" id="togglePassword" style="cursor: pointer;"></i>
          </div>
          <a class="pass" href="#">Esqueceu sua senha?</a>
          <input type="submit" value="Entrar" class="btn solid">
          <div class="social-media">
            <a class="icon-mode" onclick="toggleTheme('dark');"><i class="fas fa-moon"></i></a>
            <a class="icon-mode" onclick="toggleTheme('light');"><i class="fas fa-sun"></i></a>
          </div>
          <p class="text-mode">Tema</p>
        </form>

        <!-- Formulário de cadastro ajustado -->
        <form action="cadastrar-usuario" method="post" class="sign-up-form">
          <img src="assets/img/logo.png" alt="logo" style="height: 100px;">
          <h2 class="title">Cadastre-se</h2>

          <div class="input-field">
            <i class="fas fa-user"></i>
            <input type="text" name="nome_completo" placeholder="Digite seu nome" required>
          </div>

          <div class="input-field">
            <i class="fas fa-id-card"></i>
            <input type="text" name="cpf" placeholder="Digite seu CPF" required>
          </div>

          <div class="input-field">
            <i class="fas fa-phone"></i>
            <input type="text" name="telefone" placeholder="Digite seu Telefone" required>
          </div>

          <div class="input-field">
            <i class="fas fa-envelope"></i>
            <input type="email" name="email_institucional" placeholder="Endereço de e-mail" required>
          </div>

          <div class="input-field">
            <i class="fas fa-envelope"></i>
            <input type="email" name="email_institucional_confirm" placeholder="Repita o endereço de e-mail" required>
          </div>

          <div class="input-field">
            <i class="fas fa-lock"></i>
            <input type="password" name="senha" placeholder="Senha (mínimo de seis caracteres)" required>
          </div>

          <div class="input-field">
            <i class="fas fa-lock"></i>
            <input type="password" name="senha_confirm" placeholder="Repita a Senha (mínimo de seis caracteres)"
              required>
          </div>
          <div class="input-field">
            <i class="fas fa-map-marker-alt"></i>
            <select id="estadoSelect" name="estado" required>
              <!-- As opções de estados serão carregadas pelo JavaScript -->
            </select>
            <input type="hidden" id="cod_estado" name="cod_estado">
          </div>

          <div class="input-field">
            <i class="fas fa-city"></i>
            <select id="municipioSelect" name="municipio" required>
              <!-- As opções de municípios serão carregadas com base no estado selecionado -->
            </select>
            <input type="hidden" id="cod_cidade" name="cod_cidade">
          </div>

          <input type="submit" value="Solicitar Cadastro" class="btn solid" style="width: 250px;">
        </form>

      </div>
    </div>
    <div class="panels-container">
      <div class="panel left-panel">
        <div class="content">
          <h3>Você ainda não tem uma conta?</h3>
          <p>Crie agora uma conta para voce e desfrute de todos os nossos benefícios</p>
          <button class="btn transparent" id="sign-up-btn">Cadastre-se</button>
        </div>
        <img src="assets/img/loo.png" alt="" style="height: 100px;">
      </div>

      <div class="panel right-panel">
        <div class="content">
          <h3>Já tem uma conta?</h3>
          <p>Faça login agora para acessar seus dados</p>
          <button class="btn transparent" id="sign-in-btn">Entrar</button>
        </div>
        <img src="img/register.svg" class="image" alt="">
      </div>
    </div>
  </div>
  <script src="assets/js/login.js"></script>
  <script>
    // Função para carregar os estados
    // Função para carregar os estados
    function carregarEstados() {
      fetch('/estados')
        .then(response => response.json())
        .then(data => {
          const select = document.getElementById('estadoSelect');
          select.innerHTML = '<option value="">Selecione um estado</option>';
          data.forEach(estado => {
            const option = document.createElement('option');
            option.value = estado.codigo_uf; // Armazena o código do estado
            option.textContent = estado.nome;
            select.appendChild(option);
          });
        })
        .catch(error => console.error('Erro ao buscar estados:', error));
    }

    // Função para carregar municípios baseado no estado selecionado
    function carregarMunicipios(codigoEstado) {
      fetch(`/municipios/${codigoEstado}`)
        .then(response => response.json())
        .then(data => {
          const select = document.getElementById('municipioSelect');
          select.innerHTML = '<option value="">Selecione um município</option>';
          data.forEach(municipio => {
            const option = document.createElement('option');
            option.value = municipio.codigo_ibge; // Armazena o código do município
            option.textContent = municipio.nome;
            select.appendChild(option);
          });
        })
        .catch(error => console.error('Erro ao buscar municípios:', error));
    }

    document.getElementById('estadoSelect').addEventListener('change', function () {
      const estadoSelect = this;
      const codEstadoInput = document.getElementById('cod_estado');
      codEstadoInput.value = estadoSelect.value; // Configura o código do estado selecionado
      carregarMunicipios(estadoSelect.value);
      // Limpa o campo do município e seu código ao mudar de estado
      document.getElementById('municipioSelect').innerHTML = '<option value="">Selecione um município</option>';
      document.getElementById('cod_cidade').value = '';
    });
    document.addEventListener('DOMContentLoaded', carregarEstados);

    document.getElementById('municipioSelect').addEventListener('change', function () {
      const municipioSelect = this;
      const codCidadeInput = document.getElementById('cod_cidade');
      codCidadeInput.value = municipioSelect.value; // Configura o código do município selecionado
    });

    // Inicializar os estados quando a página carregar
    document.addEventListener('DOMContentLoaded', carregarEstados);

  </script>
  <script>
    document.getElementById('loginForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const email = formData.get('email');
      const senha = formData.get('senha');

      fetch('/entrar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, senha })
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            localStorage.setItem('userNome', data.user.nome);
            localStorage.setItem('userRole', data.user.role);
            localStorage.setItem('userCidade', data.user.cidade);
            window.location.href = '/dashboard-escolar.html';
          } else {
            alert(data.message);
          }
        })
        .catch(error => {
          console.error('Falha na requisição', error);
          alert('Erro ao processar o login.');
        });
    });
  </script>

</body>

</html>